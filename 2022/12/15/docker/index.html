<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Docker, 爱哭的小河豚">
    <meta name="description" content="Docker概述
官网地址：Docker: Accelerated, Containerized Application Development
文档地址：Docker Documentation | Docker Documentatio">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Docker | 爱哭的小河豚</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/css/matery.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/css/my.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/css/reward.css">
    



    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="爱哭的小河豚" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">爱哭的小河豚</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">爱哭的小河豚</div>
        <div class="logo-desc">
            
            谁会不喜欢一只爱哭，生气又圆鼓鼓的小河豚呢？
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Docker</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Docker/">
                                <span class="chip bg-color">Docker</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%AE%B9%E5%99%A8/" class="post-category">
                                容器
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-12-15
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-12-19
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    13.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    62 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/prism/prism.min.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h1><blockquote>
<p>官网地址：<a target="_blank" rel="noopener" href="https://www.docker.com/">Docker: Accelerated, Containerized Application Development</a></p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/">Docker Documentation | Docker Documentation</a></p>
<p>仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a></p>
</blockquote>
<h2 id="Docker为什么会出现？"><a href="#Docker为什么会出现？" class="headerlink" title="Docker为什么会出现？"></a>Docker为什么会出现？</h2><blockquote>
<ul>
<li>环境配置是十分的麻烦，每一个机器都要部署环境（集群Redis、ES、Hadoop….），费时费力。</li>
<li>发布一个项目( jar + ( Redis MySQL jdk ES ) )，项目能不能都带上环境安装打包!</li>
<li>java — jar (环境) — 打包项目带上环境（镜像) — ( Docker仓库∶商店) — 下载我们发布的镜像 — 直接运行即可!</li>
<li>隔离:Docker核心思想!打包装箱!每个箱子是互相隔离的。</li>
</ul>
</blockquote>
<h3 id="虚拟技术"><a href="#虚拟技术" class="headerlink" title="虚拟技术"></a>虚拟技术</h3><blockquote>
<ol>
<li>不用的应用 共用 同一个 后台库 + 内核，比较庞大</li>
<li>资源占用十分多</li>
<li>冗余步骤多</li>
<li>启动很慢！</li>
</ol>
</blockquote>
<img src="/2022/12/15/docker/image-20221215142733777.png" alt="image-20221215142733777" style="zoom:67%;">

<h3 id="容器化技术"><a href="#容器化技术" class="headerlink" title="容器化技术"></a>容器化技术</h3><blockquote>
<p>不同的 （应用 + 本应用运用到的后台库） 封装到同一个容器里 ，运行在同一个内核上</p>
<ul>
<li><p>应用更快速的交付和部署</p>
<p>传统：一堆帮助文档，安装程序!<br>Docker：打包镜像发布测试，一键运行!</p>
</li>
<li><p>更便捷的升级和扩缩容</p>
<p>使用了Docker之后，我们部署应用就和搭积木一样！<br>项目打包为一个镜像，扩展服务器A！服务器B!</p>
</li>
<li><p>更简单的系统运维</p>
<p>在容器化之后，我们的开发，测试环境都是高度一致的。</p>
</li>
<li><p>更高效的计算资源利用</p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上可以运行很多的容器实例！服务器的性能可以被压榨到极致。</p>
</li>
</ul>
</blockquote>
<img src="/2022/12/15/docker/image-20221215142819457.png" alt="image-20221215142819457" style="zoom:67%;">

<h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><blockquote>
<ul>
<li>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</li>
<li>容器内的应用直接运行在宿主机的内核中，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了。</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响。</li>
</ul>
</blockquote>
<h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><img src="/2022/12/15/docker/image-20221215150657323.png" alt="image-20221215150657323" style="zoom:67%;">

<blockquote>
<p><strong>镜像（ image）</strong></p>
<p>docker镜像就好比是一个模板，可以通过这个模板来创建容器服务， 通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的），镜像没有启动，停止 这些操作</p>
<p><strong>容器（ container)</strong></p>
<p>Docker利用容器技术，独立运行一个或者一个组应用，通过镜像来创建的。<br>启动，停止，刪除，基本命令！<br>目前就可以把这个容器理解为就是一个简易的inux系统</p>
<p><strong>仓库（ repository）</strong></p>
<p>仓库就是存放镜像的地方！<br>仓库分为公有仓库和私有仓库！<br>Docker Hub(默认是国外的)<br>阿里云 腾讯云 …都有容器服务器(配置镜像加速！）</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="1-查看宿主系统"><a href="#1-查看宿主系统" class="headerlink" title="1.查看宿主系统"></a>1.查看宿主系统</h3><blockquote>
<p>Docker要求宿主机系统的内核版本高于 3.10 </p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># uname -r</span>
<span class="token number">3.10</span>.0-514.el7.x86_64

<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/os-release</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"7 (Core)"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token string">"centos"</span>
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span><span class="token string">"rhel fedora"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"7"</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux 7 (Core)"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"0;31"</span>
<span class="token assign-left variable">CPE_NAME</span><span class="token operator">=</span><span class="token string">"cpe:/o:centos:centos:7"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.centos.org/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.centos.org/"</span>

<span class="token assign-left variable">CENTOS_MANTISBT_PROJECT</span><span class="token operator">=</span><span class="token string">"CentOS-7"</span>
<span class="token assign-left variable">CENTOS_MANTISBT_PROJECT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span>
<span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT</span><span class="token operator">=</span><span class="token string">"centos"</span>
<span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-卸载旧版本"><a href="#2-卸载旧版本" class="headerlink" title="2.卸载旧版本"></a>2.卸载旧版本</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum remove <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-需要的安装包"><a href="#3-需要的安装包" class="headerlink" title="3.需要的安装包"></a>3.需要的安装包</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4-设置镜像"><a href="#4-设置镜像" class="headerlink" title="4.设置镜像"></a>4.设置镜像</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum-config-manager —add-repo https://download.docker.com/linux/centos/docker-ce.repo <span class="token comment"># 默认是从国外的。</span>

yum-config-manager --add-repo   http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo <span class="token comment"># 推荐使用阿里云的。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="5-更新yum软件包索引"><a href="#5-更新yum软件包索引" class="headerlink" title="5.更新yum软件包索引"></a>5.更新yum软件包索引</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum makecache fast<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="6-安装Docker"><a href="#6-安装Docker" class="headerlink" title="6.安装Docker"></a>6.安装Docker</h3><blockquote>
<p>docker-ce（社区版）docker-ee（企业版）</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="7-启动Docker"><a href="#7-启动Docker" class="headerlink" title="7.启动Docker"></a>7.启动Docker</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="8-查看版本"><a href="#8-查看版本" class="headerlink" title="8.查看版本"></a>8.查看版本</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="9-测试hello-world"><a href="#9-测试hello-world" class="headerlink" title="9.测试hello-world"></a>9.测试hello-world</h3><pre class="line-numbers language-none"><code class="language-none">docker run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="/2022/12/15/docker/image-20221215162324883.png" alt="image-20221215162324883" style="zoom:67%;">

<img src="/2022/12/15/docker/image-20221215162533475.png" alt="image-20221215162533475" style="zoom:55%;">

<h3 id="10-查看镜像"><a href="#10-查看镜像" class="headerlink" title="10.查看镜像"></a>10.查看镜像</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    feb5d9fea6a5   <span class="token number">14</span> months ago   <span class="token number">13</span>.3kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="11-卸载Docker"><a href="#11-卸载Docker" class="headerlink" title="11.卸载Docker"></a>11.卸载Docker</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 卸载依赖</span>
yum remove docker-ce docker-ce-cli containerd.io
<span class="token comment"># 删除资源：</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><blockquote>
<ol>
<li>登录阿里云，找到容器服务。</li>
<li>找到镜像加速地址。</li>
<li>配置使用。</li>
</ol>
</blockquote>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><h3 id="Docker是怎么工作的？"><a href="#Docker是怎么工作的？" class="headerlink" title="Docker是怎么工作的？"></a>Docker是怎么工作的？</h3><blockquote>
<p>Docker 是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问！<br>DockerServer 接收到Docker-Client的指令，就会执行这个命令！</p>
</blockquote>
<p><img src="/2022/12/15/docker/image-20221215164005436.png" alt="image-20221215164005436"></p>
<h3 id="Docker为什么比VM快？"><a href="#Docker为什么比VM快？" class="headerlink" title="Docker为什么比VM快？"></a>Docker为什么比VM快？</h3><blockquote>
<ol>
<li>Docker有着比虚拟机更少的抽象层。</li>
<li>docker利用的是宿主机的内核，vm需要是Guest OS。</li>
<li>新建一个容器的时候，docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。<br>虚拟机是加载GuestOS，分钟级别的，而docker是利用宿主机的操作系统，省略了这个复杂的过程，秒级！</li>
</ol>
</blockquote>
<img src="/2022/12/15/docker/image-20221215164107426.png" alt="image-20221215164107426" style="zoom:80%;">

<h1 id="Docker的常用命令"><a href="#Docker的常用命令" class="headerlink" title="Docker的常用命令"></a>Docker的常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><blockquote>
<p>帮助文档的地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">Reference documentation | Docker Documentation</a></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">docker version        # 显示docker的版本信息
docker info              # 显示docker的系统信息，包括镜像和容器的数量
docker 命令 --help         # 帮助命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker version</span>
Client: Docker Engine - Community
 Version:           <span class="token number">20.10</span>.21
 API version:       <span class="token number">1.41</span>
 Go version:        go1.18.7
 Git commit:        baeda1f
 Built:             Tue Oct <span class="token number">25</span> <span class="token number">18</span>:04:24 <span class="token number">2022</span>
 OS/Arch:           linux/amd64
 Context:           default
 Experimental:      <span class="token boolean">true</span>

Server: Docker Engine - Community
 Engine:
  Version:          <span class="token number">20.10</span>.21
  API version:      <span class="token number">1.41</span> <span class="token punctuation">(</span>minimum version <span class="token number">1.12</span><span class="token punctuation">)</span>
  Go version:       go1.18.7
  Git commit:       <span class="token number">3056208</span>
  Built:            Tue Oct <span class="token number">25</span> <span class="token number">18</span>:02:38 <span class="token number">2022</span>
  OS/Arch:          linux/amd64
  Experimental:     <span class="token boolean">false</span>
 containerd:
  Version:          <span class="token number">1.6</span>.12
  GitCommit:        a05d175400b1145e5e6a735a6710579d181e7fb0
 runc:
  Version:          <span class="token number">1.1</span>.4
  GitCommit:        v1.1.4-0-g5fd4c4d
 docker-init:
  Version:          <span class="token number">0.19</span>.0
  GitCommit:        de40ad0
<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker info</span>
Client:
 Context:    default
 Debug Mode: <span class="token boolean">false</span>
 Plugins:
  app: Docker App <span class="token punctuation">(</span>Docker Inc., v0.9.1-beta3<span class="token punctuation">)</span>
  buildx: Docker Buildx <span class="token punctuation">(</span>Docker Inc., v0.9.1-docker<span class="token punctuation">)</span>
  scan: Docker Scan <span class="token punctuation">(</span>Docker Inc., v0.21.0<span class="token punctuation">)</span>

Server:
 Containers: <span class="token number">1</span>
  Running: <span class="token number">0</span>
  Paused: <span class="token number">0</span>
  Stopped: <span class="token number">1</span>
 Images: <span class="token number">1</span>
 Server Version: <span class="token number">20.10</span>.21
 Storage Driver: overlay2
  Backing Filesystem: xfs
  Supports d_type: <span class="token boolean">true</span>
  Native Overlay Diff: <span class="token boolean">false</span>
  userxattr: <span class="token boolean">false</span>
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: <span class="token number">1</span>
 Plugins:
  Volume: <span class="token builtin class-name">local</span>
  Network: bridge <span class="token function">host</span> ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file <span class="token builtin class-name">local</span> logentries splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: a05d175400b1145e5e6a735a6710579d181e7fb0
 runc version: v1.1.4-0-g5fd4c4d
 init version: de40ad0
 Security Options:
  seccomp
   Profile: default
 Kernel Version: <span class="token number">3.10</span>.0-514.el7.x86_64
 Operating System: CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
 OSType: linux
 Architecture: x86_64
 CPUs: <span class="token number">4</span>
 Total Memory: <span class="token number">7</span>.624GiB
 Name: lz
 ID: JIAG:DHCU:EBLG:ZXFY:SBMW:LPSW:YTXP:DLXM:E4WS:O2DX:DNBN:EWFS
 Docker Root Dir: /var/lib/docker
 Debug Mode: <span class="token boolean">false</span>
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: <span class="token boolean">false</span>
 Insecure Registries:
  <span class="token number">127.0</span>.0.0/8
 Live Restore Enabled: <span class="token boolean">false</span>

<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker info --help</span>

Usage:  <span class="token function">docker</span> info <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span>

Display system-wide information

Options:
  -f, <span class="token parameter variable">--format</span> string   Format the output using the given Go template<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><h3 id="dokcer-images"><a href="#dokcer-images" class="headerlink" title="dokcer images"></a>dokcer images</h3><blockquote>
<p>查看所有本地的主机上的镜像</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    feb5d9fea6a5   <span class="token number">10</span> months ago   <span class="token number">13</span>.3kB
<span class="token comment"># 解释</span>
REPOSITORY    镜像的仓库源
TAG            镜像的标签
IMAGE ID    镜像的id
CREATED        镜像的创建时间
SIZE        镜像的大小
<span class="token comment"># 命令参数可选项</span>
 -a, <span class="token parameter variable">--all</span>         <span class="token comment"># 显示所有镜像 (docker images -a)</span>
 -q, <span class="token parameter variable">--quiet</span>       <span class="token comment"># 仅显示镜像id (docker images -q)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h3><blockquote>
<ul>
<li>搜索镜像</li>
<li>还可以通过<a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a>搜索镜像</li>
</ul>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker search mysql</span>
NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                          MySQL is a widely used, open-source relation…   <span class="token number">12940</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
mariadb                        MariaDB Server is a high performing <span class="token function">open</span> sou…   <span class="token number">4957</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
phpmyadmin                     phpMyAdmin - A web interface <span class="token keyword">for</span> MySQL and M…   <span class="token number">587</span>       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
percona                        Percona Server is a fork of the MySQL relati…   <span class="token number">582</span>       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
<span class="token comment"># 解释</span>
<span class="token comment"># 命令参数可选项 (通过搜索来过滤)</span>
<span class="token parameter variable">--filter</span><span class="token operator">=</span>STARS<span class="token operator">=</span><span class="token number">3000</span>     <span class="token comment"># 搜索出来的镜像就是stars大于3000的</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker search mysql --filter=STARS=3000</span>
NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql     MySQL is a widely used, open-source relation…   <span class="token number">12941</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
mariadb   MariaDB Server is a high performing <span class="token function">open</span> sou…   <span class="token number">4957</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><blockquote>
<p>下载镜像</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 下载镜像：docker pull 镜像名[:tag]</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker pull mysql</span>
Using default tag: latest            <span class="token comment"># 如果不写tag，默认就是latest，最新的版本</span>
latest: Pulling from library/mysql
72a69066d2fe: Pull complete            <span class="token comment"># 分层下载，docker image的核心，联合文件下载</span>
93619dbc5b36: Pull complete
99da31dd6142: Pull complete
626033c43d70: Pull complete
37d5d7efb64e: Pull complete
ac563158d721: Pull complete
d2ba16033dad: Pull complete
688ba7d5c01a: Pull complete
00e060b6d11d: Pull complete
1c04857f594f: Pull complete
4d7cfa90e6ea: Pull complete
e0431212d27d: Pull complete
Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709 <span class="token comment">#签名</span>
Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest
docker.io/library/mysql:latest        <span class="token comment"># 真实地址</span>
<span class="token comment"># 两个命令是等价的</span>
<span class="token function">docker</span> pull mysql
<span class="token function">docker</span> pull docker.io/library/mysql:latest
<span class="token comment"># 指定版本下载</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker pull mysql:5.7</span>
<span class="token number">5.7</span>: Pulling from library/mysql
72a69066d2fe: Already exists        <span class="token comment"># 联合文件下载，已经存在的资源可以共用</span>
93619dbc5b36: Already exists
99da31dd6142: Already exists
626033c43d70: Already exists
37d5d7efb64e: Already exists
ac563158d721: Already exists
d2ba16033dad: Already exists
0ceb82207cd7: Pull complete
37f2405cae96: Pull complete
e2482e017e53: Pull complete
70deed891d42: Pull complete
Digest: sha256:f2ad209efe9c67104167fc609cca6973c8422939491c9345270175a300419f94
Status: Downloaded newer image <span class="token keyword">for</span> mysql:5.7
docker.io/library/mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h3><blockquote>
<p>删除镜像</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker rmi -f 镜像id                    # 删除指定的镜像</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker rmi -f 镜像id 镜像id 镜像id    # 删除多个镜像（空格分隔）</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker rmi -f $(docker images -aq)    # 删除全部的镜像</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><blockquote>
<p>说明：我们有了镜像才可以创建容器，linux，下载一个centos 镜像来测试学习。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull centos<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="新建容器并启动"><a href="#新建容器并启动" class="headerlink" title="新建容器并启动"></a>新建容器并启动</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token punctuation">[</span>可选参数<span class="token punctuation">]</span> image
<span class="token comment"># 参数说明</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">"name"</span>         容器名字：用来区分容器
<span class="token parameter variable">-d</span>                    后台方式运行：相当于nohup
<span class="token parameter variable">-it</span>                   使用交互式运行：进入容器查看内容
<span class="token parameter variable">-p</span>                    指定容器的端口（四种方式）小写字母p
    <span class="token parameter variable">-p</span> ip:主机端口：容器端口
    <span class="token parameter variable">-p</span> 主机端口：容器端口
    <span class="token parameter variable">-p</span> 容器端口
    容器端口
<span class="token parameter variable">-P</span>                     随机指定端口（大写字母P）

<span class="token comment"># 测试：启动并进入容器</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@526c31d2c298 /<span class="token punctuation">]</span><span class="token comment"># ls        # 查看容器内的centos（基础版本，很多命令都是不完善的）</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

<span class="token comment"># 从容器中退回到主机</span>
<span class="token punctuation">[</span>root@526c31d2c298 /<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ /<span class="token punctuation">]</span><span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  www<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="列出所有运行的容器"><a href="#列出所有运行的容器" class="headerlink" title="列出所有运行的容器"></a>列出所有运行的容器</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span>    <span class="token comment"># 列出当前正在运行的容器</span>
<span class="token comment"># 命令参数可选项</span>
<span class="token parameter variable">-a</span>        <span class="token comment"># 列出当前正在运行的容器+历史运行过的容器</span>
<span class="token parameter variable">-n</span><span class="token operator">=</span>?    <span class="token comment"># 显示最近创建的容器（可以指定显示几条，比如-n=1）</span>
<span class="token parameter variable">-q</span>        <span class="token comment"># 只显示容器的编号</span>

<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ /<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ /<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS                     PORTS     NAMES
526c31d2c298   centos         <span class="token string">"/bin/bash"</span>   <span class="token number">4</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> minutes ago             optimistic_allen
ce0eb11fbf8a   feb5d9fea6a5   <span class="token string">"/hello"</span>      <span class="token number">4</span> hours ago     Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">4</span> hours ago               keen_ellis
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ /<span class="token punctuation">]</span><span class="token comment"># docker ps -a -n=1</span>
CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                     PORTS     NAMES
526c31d2c298   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">5</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">3</span> minutes ago             optimistic_allen<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span>        <span class="token comment"># 容器直接停止，并退出</span>
ctrl+P+Q    <span class="token comment"># 容器不停止，退出</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@c5d61aa9d7df /<span class="token punctuation">]</span><span class="token comment"># [root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker ps</span>
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
c5d61aa9d7df   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">56</span> seconds ago   Up <span class="token number">55</span> seconds             kind_clarke
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">rm</span> 容器id                    <span class="token comment"># 删除容器（不能删除正在运行的容器）如果要强制删除：docker rm -f 容器id</span>
<span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span><span class="token variable">)</span></span>        <span class="token comment"># 删除全部容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> -q<span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span>        <span class="token comment"># 删除所有容器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="启动和停止容器的操作"><a href="#启动和停止容器的操作" class="headerlink" title="启动和停止容器的操作"></a>启动和停止容器的操作</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> start 容器id        <span class="token comment"># 启动容器</span>
<span class="token function">docker</span> restart 容器id    <span class="token comment"># 重启容器</span>
<span class="token function">docker</span> stop 容器id        <span class="token comment"># 停止当前正在运行的容器</span>
<span class="token function">docker</span> <span class="token function">kill</span> 容器id        <span class="token comment"># 强制停止当前容器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h2><h3 id="后台启动容器"><a href="#后台启动容器" class="headerlink" title="后台启动容器"></a>后台启动容器</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 命令docker run -d 镜像名[:tag]    不加tag，默认找最近的版本</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d centos</span>

<span class="token comment"># 问题：docker ps发现centos停止了</span>

<span class="token comment"># 常见的坑：docker容器使用后台运行，就必须要有要一个前台进程，docker发现没有应用，就会自动停止。</span>

<span class="token comment"># 比如：nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># docker logs -tf --tail 容器id</span>
<span class="token comment"># 自己编写一段shell脚本</span>
<span class="token comment"># docker run -d centos /bin/sh -c "while true;do echo kuangshen;sleep 1;done"</span>

<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker logs -tf  容器id</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker logs -tf --tail 10  容器id</span>

<span class="token comment"># 显示日志</span>
<span class="token parameter variable">-tf</span>              <span class="token comment"># 显示日志</span>
<span class="token parameter variable">--tail</span> number    <span class="token comment"># 要显示的日志条数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="查看容器中进程的信息"><a href="#查看容器中进程的信息" class="headerlink" title="查看容器中进程的信息"></a>查看容器中进程的信息</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 命令 docker top 容器id </span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker top 88d23bcbe1f2</span>
<span class="token environment constant">UID</span>                 PID                 <span class="token environment constant">PPID</span>                C                   STIME               TTY                 TIME                CMD
root                <span class="token number">21212</span>               <span class="token number">21193</span>               <span class="token number">0</span>                   <span class="token number">16</span>:23               ?                   00:00:00            
root                <span class="token number">21600</span>               <span class="token number">21212</span>               <span class="token number">0</span>                   <span class="token number">16</span>:29               ?                   00:00:00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="查看镜像的元数据"><a href="#查看镜像的元数据" class="headerlink" title="查看镜像的元数据"></a>查看镜像的元数据</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 命令docker inspect 容器id</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"88d23bcbe1f28e1f8ae5d2b63fa8d57d2abcbdacf193db05852f4f74a95b9ffe"</span>,
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-07-29T08:23:56.862239223Z"</span>,
        <span class="token string">"Path"</span><span class="token builtin class-name">:</span> <span class="token string">"/bin/sh"</span>,
        <span class="token string">"Args"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"-c"</span>,
            <span class="token string">"while true;do echo kuangshen;sleep 1;done"</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"State"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Status"</span><span class="token builtin class-name">:</span> <span class="token string">"running"</span>,
            <span class="token string">"Running"</span><span class="token builtin class-name">:</span> true,
            <span class="token string">"Paused"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Restarting"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"OOMKilled"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Dead"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Pid"</span><span class="token builtin class-name">:</span> <span class="token number">21212</span>,
            <span class="token string">"ExitCode"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"Error"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"StartedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-07-29T08:23:57.109766809Z"</span>,
            <span class="token string">"FinishedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"0001-01-01T00:00:00Z"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Image"</span><span class="token builtin class-name">:</span> <span class="token string">"sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6"</span>,
        <span class="token string">"ResolvConfPath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/88d23bcbe1f28e1f8ae5d2b63fa8d57d2abcbdacf193db05852f4f74a95b9ffe/resolv.conf"</span>,
        <span class="token string">"HostnamePath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/88d23bcbe1f28e1f8ae5d2b63fa8d57d2abcbdacf193db05852f4f74a95b9ffe/hostname"</span>,
        <span class="token string">"HostsPath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/88d23bcbe1f28e1f8ae5d2b63fa8d57d2abcbdacf193db05852f4f74a95b9ffe/hosts"</span>,
        <span class="token string">"LogPath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/88d23bcbe1f28e1f8ae5d2b63fa8d57d2abcbdacf193db05852f4f74a95b9ffe/88d23bcbe1f28e1f8ae5d2b63fa8d57d2abcbdacf193db05852f4f74a95b9ffe-json.log"</span>,
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"/silly_lichterman"</span>,
        <span class="token string">"RestartCount"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"overlay2"</span>,
        <span class="token string">"Platform"</span><span class="token builtin class-name">:</span> <span class="token string">"linux"</span>,
        <span class="token string">"MountLabel"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"ProcessLabel"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"AppArmorProfile"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"ExecIDs"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"HostConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Binds"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"ContainerIDFile"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"LogConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"json-file"</span>,
                <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"NetworkMode"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
            <span class="token string">"PortBindings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"RestartPolicy"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"no"</span>,
                <span class="token string">"MaximumRetryCount"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"AutoRemove"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"VolumeDriver"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"VolumesFrom"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"CapAdd"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"CapDrop"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"CgroupnsMode"</span><span class="token builtin class-name">:</span> <span class="token string">"host"</span>,
            <span class="token string">"Dns"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"DnsOptions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"DnsSearch"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"ExtraHosts"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"GroupAdd"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"IpcMode"</span><span class="token builtin class-name">:</span> <span class="token string">"private"</span>,
            <span class="token string">"Cgroup"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"Links"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"OomScoreAdj"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"PidMode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"Privileged"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"PublishAllPorts"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"ReadonlyRootfs"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"SecurityOpt"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"UTSMode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"UsernsMode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"ShmSize"</span><span class="token builtin class-name">:</span> <span class="token number">67108864</span>,
            <span class="token string">"Runtime"</span><span class="token builtin class-name">:</span> <span class="token string">"runc"</span>,
            <span class="token string">"ConsoleSize"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token number">0</span>,
                <span class="token number">0</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Isolation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"CpuShares"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"Memory"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"NanoCpus"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"CgroupParent"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"BlkioWeight"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"BlkioWeightDevice"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"BlkioDeviceReadBps"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"BlkioDeviceWriteBps"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"BlkioDeviceReadIOps"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"BlkioDeviceWriteIOps"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"CpuPeriod"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"CpuQuota"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"CpuRealtimePeriod"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"CpuRealtimeRuntime"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"CpusetCpus"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"CpusetMems"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"Devices"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"DeviceCgroupRules"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"DeviceRequests"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"KernelMemory"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"KernelMemoryTCP"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"MemoryReservation"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"MemorySwap"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"MemorySwappiness"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"OomKillDisable"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"PidsLimit"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"Ulimits"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"CpuCount"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"CpuPercent"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"IOMaximumIOps"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"IOMaximumBandwidth"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"MaskedPaths"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/proc/asound"</span>,
                <span class="token string">"/proc/acpi"</span>,
                <span class="token string">"/proc/kcore"</span>,
                <span class="token string">"/proc/keys"</span>,
                <span class="token string">"/proc/latency_stats"</span>,
                <span class="token string">"/proc/timer_list"</span>,
                <span class="token string">"/proc/timer_stats"</span>,
                <span class="token string">"/proc/sched_debug"</span>,
                <span class="token string">"/proc/scsi"</span>,
                <span class="token string">"/sys/firmware"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"ReadonlyPaths"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/proc/bus"</span>,
                <span class="token string">"/proc/fs"</span>,
                <span class="token string">"/proc/irq"</span>,
                <span class="token string">"/proc/sys"</span>,
                <span class="token string">"/proc/sysrq-trigger"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"GraphDriver"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Data"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"LowerDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/59b088d44f6e67f4ed336de44d19a5784c1a13fa856760bd2b166c4a4d421e2b-init/diff:/var/lib/docker/overlay2/7fc43e24b63e4656ab7e7718d3e4ef5297fe82509452be305a01605a7cdc3b97/diff"</span>,
                <span class="token string">"MergedDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/59b088d44f6e67f4ed336de44d19a5784c1a13fa856760bd2b166c4a4d421e2b/merged"</span>,
                <span class="token string">"UpperDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/59b088d44f6e67f4ed336de44d19a5784c1a13fa856760bd2b166c4a4d421e2b/diff"</span>,
                <span class="token string">"WorkDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/59b088d44f6e67f4ed336de44d19a5784c1a13fa856760bd2b166c4a4d421e2b/work"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"overlay2"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Hostname"</span><span class="token builtin class-name">:</span> <span class="token string">"88d23bcbe1f2"</span>,
            <span class="token string">"Domainname"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"User"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"AttachStdin"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"AttachStdout"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"AttachStderr"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Tty"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"OpenStdin"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"StdinOnce"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Env"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Cmd"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/bin/sh"</span>,
                <span class="token string">"-c"</span>,
                <span class="token string">"while true;do echo kuangshen;sleep 1;done"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Image"</span><span class="token builtin class-name">:</span> <span class="token string">"centos"</span>,
            <span class="token string">"Volumes"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"WorkingDir"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"Entrypoint"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"OnBuild"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"org.label-schema.build-date"</span><span class="token builtin class-name">:</span> <span class="token string">"20210915"</span>,
                <span class="token string">"org.label-schema.license"</span><span class="token builtin class-name">:</span> <span class="token string">"GPLv2"</span>,
                <span class="token string">"org.label-schema.name"</span><span class="token builtin class-name">:</span> <span class="token string">"CentOS Base Image"</span>,
                <span class="token string">"org.label-schema.schema-version"</span><span class="token builtin class-name">:</span> <span class="token string">"1.0"</span>,
                <span class="token string">"org.label-schema.vendor"</span><span class="token builtin class-name">:</span> <span class="token string">"CentOS"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"NetworkSettings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Bridge"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"SandboxID"</span><span class="token builtin class-name">:</span> <span class="token string">"bfc28d2ba671adfe5c93325173b93c335d50d8b017eed4fdce2ab75410d6ac2e"</span>,
            <span class="token string">"HairpinMode"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"LinkLocalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"LinkLocalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"Ports"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"SandboxKey"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/run/docker/netns/bfc28d2ba671"</span>,
            <span class="token string">"SecondaryIPAddresses"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"SecondaryIPv6Addresses"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"ad0252d454e751e2c5ecef24e64c32b0884c53242925bd66e9e5dbf5542af179"</span>,
            <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span>,
            <span class="token string">"GlobalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"IPAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.2"</span>,
            <span class="token string">"IPPrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
            <span class="token string">"IPv6Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,
            <span class="token string">"Networks"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"bridge"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"IPAMConfig"</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">"Links"</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">"Aliases"</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">"NetworkID"</span><span class="token builtin class-name">:</span> <span class="token string">"7254ffccbdf53e0c72c1d19252980f04fa65153ea3c7ca72af55cfac504cbe3f"</span>,
                    <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"ad0252d454e751e2c5ecef24e64c32b0884c53242925bd66e9e5dbf5542af179"</span>,
                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span>,
                    <span class="token string">"IPAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.2"</span>,
                    <span class="token string">"IPPrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                    <span class="token string">"IPv6Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
                    <span class="token string">"GlobalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
                    <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,
                    <span class="token string">"DriverOpts"</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span>
<span class="token comment"># 命令</span>
<span class="token comment"># docker exec -it 容器id /bin/bash</span>

<span class="token comment"># 测试</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES
88d23bcbe1f2   centos    <span class="token string">"/bin/sh -c 'while t…"</span>   <span class="token number">13</span> minutes ago   Up <span class="token number">13</span> minutes             silly_lichterman
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 88d23bcbe1f2 /bin/bash</span>
<span class="token punctuation">[</span>root@88d23bcbe1f2 /<span class="token punctuation">]</span><span class="token comment"># ps -ef</span>
<span class="token environment constant">UID</span>        PID  <span class="token environment constant">PPID</span>  C STIME TTY          TIME CMD
root         <span class="token number">1</span>     <span class="token number">0</span>  <span class="token number">0</span> 08:23 ?        00:00:00 /bin/sh <span class="token parameter variable">-c</span> <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">echo</span> kuangshen<span class="token punctuation">;</span><span class="token function">sleep</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">done</span>
root       <span class="token number">841</span>     <span class="token number">0</span>  <span class="token number">0</span> 08:37 pts/0    00:00:00 /bin/bash
root       <span class="token number">858</span>     <span class="token number">1</span>  <span class="token number">0</span> 08:37 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang<span class="token operator">=</span>sleep /usr/bin/sleep <span class="token number">1</span>
root       <span class="token number">859</span>   <span class="token number">841</span>  <span class="token number">0</span> 08:37 pts/0    00:00:00 <span class="token function">ps</span> <span class="token parameter variable">-ef</span>

<span class="token comment"># 方式二</span>
<span class="token comment"># docker attach 容器id</span>
<span class="token comment"># 测试</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker attach 88d23bcbe1f2</span>
正在执行当前的代码<span class="token punctuation">..</span>.

<span class="token comment"># docker exec        # 进入容器后开启一个新的终端，可以再里面操作（常用）</span>
<span class="token comment"># docker attach        # 进入容器正在执行的终端，不会启动新的进程。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="从容器内拷贝文件到主机上"><a href="#从容器内拷贝文件到主机上" class="headerlink" title="从容器内拷贝文件到主机上"></a>从容器内拷贝文件到主机上</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># docker cp 容器id:容器内路径 目的主机的路径</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">0</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@6eda31ad7987 /<span class="token punctuation">]</span><span class="token comment"># [root@iZbp13qr3mm4ucsjumrlgqZ home]# docker ps</span>
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
6eda31ad7987   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">17</span> seconds ago   Up <span class="token number">16</span> seconds             stoic_kepler
<span class="token comment"># 进入到容器内部</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># docker attach 6eda31ad7987</span>
<span class="token punctuation">[</span>root@6eda31ad7987 /<span class="token punctuation">]</span><span class="token comment"># ls</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token punctuation">[</span>root@6eda31ad7987 /<span class="token punctuation">]</span><span class="token comment"># cd /home/</span>
<span class="token punctuation">[</span>root@6eda31ad7987 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token comment"># 在容器的/home路径下创建test.java文件</span>
<span class="token punctuation">[</span>root@6eda31ad7987 home<span class="token punctuation">]</span><span class="token comment"># touch test.java</span>
<span class="token punctuation">[</span>root@6eda31ad7987 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.java
<span class="token punctuation">[</span>root@6eda31ad7987 home<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS                      PORTS     NAMES
6eda31ad7987   centos    <span class="token string">"/bin/bash"</span>   About a minute ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">28</span> seconds ago             stoic_kepler
<span class="token comment"># 将文件拷贝出来到主机上（在主机上执行该命令）</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># docker cp 6eda31ad7987:/home/test.java /home</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ home<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.java
<span class="token comment"># 拷贝是一个手动过程，未来我们使用 -v 卷的技术，可以实现，自动同步（容器内的/home路径和主机上的/home路径打通）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="/2022/12/15/docker/383865dd59f64bd88cbe6b4a56f1315c.png"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">attach    Attach to a running container                                  <span class="token comment">#当前shell下attach连接指定运行镜像</span>
build     Build an image from a Dockerfile                               <span class="token comment">#通过Dockerfile定制镜像</span>
commit    Create a new image from a containers changes                   <span class="token comment">#提交当前容器为新的镜像</span>
<span class="token function">cp</span>          Copy files/folders from a container to a HOSTDIR or to STDOUT  <span class="token comment">#从容器中拷贝指定文件或者目录到宿主机中</span>
create    Create a new container                                         <span class="token comment">#创建一个新的容器，同run 但不启动容器</span>
<span class="token function">diff</span>      Inspect changes on a containers filesystem                     <span class="token comment">#查看docker容器变化</span>
events    Get real <span class="token function">time</span> events from the server                           <span class="token comment">#从docker服务获取容器实时事件</span>
<span class="token builtin class-name">exec</span>      Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> a running container                           <span class="token comment">#在已存在的容器上运行命令</span>
<span class="token builtin class-name">export</span>    Export a containers filesystem as a <span class="token function">tar</span> archive                <span class="token comment">#导出容器的内容流作为一个tar归档文件(对应import)</span>
<span class="token function">history</span>   Show the <span class="token function">history</span> of an image                                   <span class="token comment">#展示一个镜像形成历史</span>
images    List images                                                    <span class="token comment">#列出系统当前镜像</span>
<span class="token function">import</span>    Import the contents from a tarball to create a filesystem image  <span class="token comment">#从tar包中的内容创建一个新的文件系统映像(对应export)</span>
info      Display system-wide information                                <span class="token comment">#显示系统相关信息</span>
inspect   Return low-level information on a container or image           <span class="token comment">#查看容器详细信息</span>
<span class="token function">kill</span>      Kill a running container                                       <span class="token comment">#kill指定docker容器</span>
load      Load an image from a <span class="token function">tar</span> archive or STDIN                      <span class="token comment">#从一个tar包中加载一个镜像(对应save)</span>
login     Register or log <span class="token keyword">in</span> to a Docker registry                        <span class="token comment">#注册或者登陆一个docker源服务器</span>
<span class="token builtin class-name">logout</span>    Log out from a Docker registry                                 <span class="token comment">#从当前Docker registry退出</span>
logs      Fetch the logs of a container                                  <span class="token comment">#输出当前容器日志信息</span>
pause     Pause all processes within a container                         <span class="token comment">#暂停容器</span>
port      List port mappings or a specific mapping <span class="token keyword">for</span> the CONTAINER     <span class="token comment">#查看映射端口对应的容器内部源端口</span>
<span class="token function">ps</span>        List containers                                                <span class="token comment">#列出容器列表</span>
pull      Pull an image or a repository from a registry                  <span class="token comment">#从docker镜像源服务器拉取指定镜像或者库镜像</span>
push      Push an image or a repository to a registry                    <span class="token comment">#推送指定镜像或者库镜像至docker源服务器</span>
<span class="token function">rename</span>    Rename a container                                             <span class="token comment">#重命名容器</span>
restart   Restart a running container                                    <span class="token comment">#重启运行的容器</span>
<span class="token function">rm</span>        Remove one or <span class="token function">more</span> containers                                  <span class="token comment">#移除一个或者多个容器</span>
rmi       Remove one or <span class="token function">more</span> images                                      <span class="token comment">#移除一个或多个镜像(无容器使用该镜像才可以删除，否则需要删除相关容器才可以继续或者-f强制删除)</span>
run       Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> a new container                               <span class="token comment">#创建一个新的容器并运行一个命令</span>
save      Save an image<span class="token punctuation">(</span>s<span class="token punctuation">)</span> to a <span class="token function">tar</span> archive                              <span class="token comment">#保存一个镜像为一个tar包(对应load)</span>
search    Search the Docker Hub <span class="token keyword">for</span> images                               <span class="token comment">#在docker hub中搜索镜像</span>
start     Start one or <span class="token function">more</span> stopped containers                           <span class="token comment">#启动容器</span>
stats     Display a live stream of container<span class="token punctuation">(</span>s<span class="token punctuation">)</span> resource usage statistics  <span class="token comment">#统计容器使用资源</span>
stop      Stop a running container                                       <span class="token comment">#停止容器</span>
tag       Tag an image into a repository                                 <span class="token comment">#给源中镜像打标签</span>
<span class="token function">top</span>       Display the running processes of a container                   <span class="token comment">#查看容器中运行的进程信息</span>
unpause   Unpause all processes within a container                       <span class="token comment">#取消暂停容器</span>
version   Show the Docker version information                            <span class="token comment">#查看容器版本号</span>
<span class="token function">wait</span>      Block <span class="token keyword">until</span> a container stops, <span class="token keyword">then</span> print its <span class="token builtin class-name">exit</span> code        <span class="token comment">#截取容器停止时的退出状态值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker search nginx</span>
NAME                                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
nginx                                             Official build of Nginx.                        <span class="token number">17820</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>                        
<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker pull nginx</span>
Using default tag: latest
latest: Pulling from library/nginx
025c56f98b67: Pull complete 
ec0f5d052824: Pull complete 
cc9fb8360807: Pull complete 
defc9ba04d7c: Pull complete 
885556963dad: Pull complete 
f12443e5c9f7: Pull complete 
Digest: sha256:75263be7e5846fc69cb6c42553ff9c93d653d769b94917dbda71d42d3f3c00d3
Status: Downloaded newer image <span class="token keyword">for</span> nginx:latest
docker.io/library/nginx:latest
<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p3344:80 --name mynginx nginx</span>
02ab5a5c26c811ea075ccfd7c3c6a45a72f8a8b2dd82ae647df81197631e9432
<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                                   NAMES
02ab5a5c26c8   nginx     <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">5</span> seconds ago   Up <span class="token number">4</span> seconds   <span class="token number">0.0</span>.0.0:3344-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::3344-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   mynginx
<span class="token punctuation">[</span>root@lz ~<span class="token punctuation">]</span><span class="token comment"># curl http://localhost:3344</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{</span> color-scheme: light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{</span> width: 35em<span class="token punctuation">;</span> margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/2022/12/15/docker/2021072014364032.png" alt="端口暴露示意图" style="zoom:67%;">

<h3 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 官方的使用</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> tomcat:9.0
<span class="token comment"># 我们之前的启动都是后台，停止了容器之后，容器还是可以查到     docker run -it --rm，一般用来测试，用完就删除</span>

<span class="token comment"># 下载再启动</span>
<span class="token function">docker</span> pull tomcat 

<span class="token comment"># 启动运行</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3355</span>:8080 <span class="token parameter variable">--name</span> tomcat01 tomcat
<span class="token comment"># 测试访问没有问题</span>

<span class="token comment"># 进入容器</span>
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ home<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat01 /bin/bash</span>

<span class="token comment"># 发现问题：1、linux命令少了，2、没有webapps，阿里云镜像的原因。默认是最小的镜像，所有不必要的都剔除掉了。</span>
<span class="token comment"># 保证最小可运行的环境</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="安装es-kibana"><a href="#安装es-kibana" class="headerlink" title="安装es+kibana"></a>安装es+kibana</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># es 暴露的端口很多！</span>

<span class="token comment"># es 十分耗内存</span>

<span class="token comment"># es 的数据一般需要放置到安全目录！挂载</span>

<span class="token comment"># --net somenetwork ? 网络配置</span>

<span class="token comment"># 下载启动elasticsearch（Docker一步搞定）</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> elasticsearch <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token parameter variable">-e</span>
<span class="token string">"discovery.type=single-node"</span> elasticsearch:7.6.2

<span class="token comment"># 测试一下es是否成功启动</span>
➜ ~ <span class="token function">curl</span> localhost:9200
<span class="token punctuation">{</span>
<span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"d73ad2f22dd3"</span>,
<span class="token string">"cluster_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker-cluster"</span>,
<span class="token string">"cluster_uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"atFKgANxS8CzgIyCB8PGxA"</span>,
<span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<span class="token string">"number"</span> <span class="token builtin class-name">:</span> <span class="token string">"7.6.2"</span>,
<span class="token string">"build_flavor"</span> <span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
<span class="token string">"build_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker"</span>,
<span class="token string">"build_hash"</span> <span class="token builtin class-name">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span>,
<span class="token string">"build_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span>,
<span class="token string">"build_snapshot"</span> <span class="token builtin class-name">:</span> false,
<span class="token string">"lucene_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"8.4.0"</span>,
<span class="token string">"minimum_wire_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.8.0"</span>,
<span class="token string">"minimum_index_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.0.0-beta1"</span>
<span class="token punctuation">}</span>,
<span class="token string">"tagline"</span> <span class="token builtin class-name">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span>

<span class="token comment"># 查看docker容器使用内存情况（每秒刷新，也挺耗内存的一个命令）</span>
➜ ~ <span class="token function">docker</span> stats

<span class="token comment">#关闭，添加内存的限制，修改配置文件 -e 环境配置修改</span>
➜ ~ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> d73ad2f22dd3
➜ ~ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> elasticsearch <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token parameter variable">-e</span>
<span class="token string">"discovery.type=single-node"</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms64m -Xmx512m"</span>
elasticsearch:7.6.2

➜ ~ <span class="token function">curl</span> localhost:9200
<span class="token punctuation">{</span>
<span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"b72c9847ec48"</span>,
<span class="token string">"cluster_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker-cluster"</span>,
<span class="token string">"cluster_uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"yNAK0EORSvq3Wtaqe2QqAg"</span>,
<span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<span class="token string">"number"</span> <span class="token builtin class-name">:</span> <span class="token string">"7.6.2"</span>,
<span class="token string">"build_flavor"</span> <span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
<span class="token string">"build_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker"</span>,
<span class="token string">"build_hash"</span> <span class="token builtin class-name">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span>,
<span class="token string">"build_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span>,
<span class="token string">"build_snapshot"</span> <span class="token builtin class-name">:</span> false,
<span class="token string">"lucene_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"8.4.0"</span>,
<span class="token string">"minimum_wire_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.8.0"</span>,
<span class="token string">"minimum_index_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.0.0-beta1"</span>
<span class="token punctuation">}</span>,
<span class="token string">"tagline"</span> <span class="token builtin class-name">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>使用kibana连接es，思考网络如何才能连接？</p>
</blockquote>
<p><img src="/2022/12/15/docker/image-20221215225912666.png" alt="image-20221215225912666"></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 运行如下命令即可 打开可视化服务</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8088</span>:9000 <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true portainer/portainer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>访问<a target="_blank" rel="noopener" href="http://ip:8088/">http://ip:8088</a></p>
</blockquote>
<h1 id="Docker镜像讲解"><a href="#Docker镜像讲解" class="headerlink" title="Docker镜像讲解"></a>Docker镜像讲解</h1><h2 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h2><blockquote>
<p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p>所有的应用，直接打包docker镜像，就可以直接跑起来！</p>
<p>如何得到镜像：</p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝给你</li>
<li>自己制作一个镜像DockerFile</li>
</ul>
</blockquote>
<h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><blockquote>
<p><strong>UnionFS（联合文件系统）</strong>：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual filesystem）。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把文件系统及叠加起来，这样最终的文件系统包含所有底层的文件和目录</p>
</blockquote>
<h3 id="Dcoker镜像加载原理"><a href="#Dcoker镜像加载原理" class="headerlink" title="Dcoker镜像加载原理"></a>Dcoker镜像加载原理</h3><blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们电箱的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs（root file system），在bootfs之上。包含的就是典型Linux 系统中的 /dev，/proc，/bin，/etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210721144206155.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>平时我们安装进虚拟机的CentOS都是好几个G，为什么Docker这里才200M？</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210721144331307.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>对于个精简的OS,rootfs可以很小，只需要包合最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的Linux发行版， boots基本是一致的， rootfs会有差別，因此不同的发行版可以公用bootfs。</p>
<p>虚拟机是分钟级别，容器是秒级！</p>
</blockquote>
<h2 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h2><blockquote>
<p>我们可以去下载一个镜像，注意观察下载的日志输出，可以看到是一层层的在下载 。</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210721144927925.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>思考：为什么Docker镜像要采用这种分层的结构呢？</p>
<p>最大的好处，我觉得莫过于资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p>
<p>查看镜像分层的方式可以通过docker image inspect 命令</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker image inspect redis:latest</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
    //<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
        <span class="token string">"RootFS"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"layers"</span>,
            <span class="token string">"Layers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"sha256:764055ebc9a7a290b64d17cf9ea550f1099c202d83795aa967428ebdf335c9f7"</span>,
                <span class="token string">"sha256:245c9d23f65373415922e53424032cabe7b282c5cf8f9f8070a7d1830fca6871"</span>,
                <span class="token string">"sha256:ebef6caacb966ed54c0c3facf2288fa5124452f2c0a17faa1941625eab0ceb54"</span>,
                <span class="token string">"sha256:0b7b774038f08ec329e4dd2c0be440c487cfb003a05fce87cd5d1497b602f2c1"</span>,
                <span class="token string">"sha256:a71d36a87572d637aa446110faf8abb4ea74f028d0e0737f2ff2b983ef23abf3"</span>,
                <span class="token string">"sha256:9e1fddfb3a22146392a2d6491e1af2f087da5e6551849a6174fa23051ef8a38f"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"LastTagTime"</span><span class="token builtin class-name">:</span> <span class="token string">"0001-01-01T00:00:00Z"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>理解：</p>
<p>所有的docker镜像都起始于一个基础镜像层，当进行修改或者增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>举一个简单的例子，加入基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加Python包，就会在基础镜像层之上穿件第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</p>
<p>该镜像当前已经包含3个镜像层，如下图（这只是一个用于演示的很简单的例子）。</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210721150133371.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>在添加额外的镜像层的同时，镜像始终是保持当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像层包含了来自两镜像层的6个文件。</p>
</blockquote>
<p><img src="/2022/12/15/docker/202107211515246.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>上图中的镜像层跟之前图中的略有区别，主要目的是便于展示文件。</p>
<p>下图总展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层的文件7是文件5的一个更新版本。</p>
</blockquote>
<p><img src="/2022/12/15/docker/2021072115154375.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新的镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实心镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</p>
<p>Linux 上可用的存储引擎有AUFS、Overlay2，Device Maper、Btrfs 以及 ZFS。顾名思义，没种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windowsfiler 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW[1]。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210721155437445.png" alt="在这里插入图片描述"></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><blockquote>
<p>Docker镜像都是只读的，当容器启东时，一个新的可写层被加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层。</p>
</blockquote>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># docker commit 提交容器成为一个新的副本</span>

<span class="token comment"># 命令和git原理类似</span>
<span class="token comment"># docker commit -m="描述信息" -a="作者" 容器id 目标镜像名:[TAG]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1、启动一个默认的tomcat</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 tomcat

<span class="token comment"># 2、发现这个默认的tomcat 是没有webapps应用，官方的镜像默认webapps下面是没有文件的！</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器id

<span class="token comment"># 3、拷贝文件进去</span>

<span class="token comment"># 4、将操作过的容器通过commit为一个镜像！我们以后就使用我们修改过的镜像即可，这就是我们自己的一个修改的镜像。</span>
<span class="token function">docker</span> commit <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">"描述信息"</span> <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">"作者"</span> 容器id 目标镜像名:<span class="token punctuation">[</span>TAG<span class="token punctuation">]</span>docker commit <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">"kuangshen"</span> <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">"add webapps app"</span> 容器id tomcat02:1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/20210721171339835.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>如果你想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像，就好比我们我们使用虚拟机的快照。</p>
</blockquote>
<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><h2 id="什么是容器数据卷？"><a href="#什么是容器数据卷？" class="headerlink" title="什么是容器数据卷？"></a>什么是容器数据卷？</h2><blockquote>
<p>docker的理念回顾</p>
<p>将应用和环境打包成一个镜像！</p>
<p>数据？如果数据都在容器中，那么我们容器删除，数据就会丢失！需求：数据可以持久化</p>
<p>MySQL，容器删除了，删库跑路！需求：MySQL数据可以存储在本地！</p>
<p>容器之间可以有一个数据共享的技术！Docker容器中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Linux上面！</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210721201603322.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>总结一句话：容器的持久化和同步操作！容器间也是可以数据共享的！</p>
</blockquote>
<h2 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h2><blockquote>
<p>方式一 ：直接使用命令挂载 -v</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-v, <span class="token parameter variable">--volume</span> list Bind <span class="token function">mount</span> a volume

<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">-v</span> 主机目录:容器内目录    

<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ home<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/ceshi:/home centos /bin/bash</span>

<span class="token comment">#通过 docker inspect 容器id 查看</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/20210721203421418.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>测试文件的同步</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210722090336334.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>再来测试！<br>1、停止容器<br>2、宿主机修改文件<br>3、启动容器<br>4、容器内的数据依旧是同步的</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210722090353939.png" alt="在这里插入图片描述"></p>
<h2 id="实战：安装MySQL"><a href="#实战：安装MySQL" class="headerlink" title="实战：安装MySQL"></a>实战：安装MySQL</h2><blockquote>
<p>思考：MySQL的数据持久化的问题</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 获取mysql镜像</span>
➜ ~ <span class="token function">docker</span> pull mysql:5.7

<span class="token comment"># 运行容器,需要做数据挂载 #安装启动mysql，需要配置密码的，这是要注意点！</span>
<span class="token comment"># 参考官网hub</span>
<span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-mysql <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw <span class="token parameter variable">-d</span> mysql:tag

<span class="token comment">#启动我们得</span>
<span class="token parameter variable">-d</span> 后台运行
<span class="token parameter variable">-p</span> 端口映射
<span class="token parameter variable">-v</span> 卷挂载
<span class="token parameter variable">-e</span> 环境配置
-- name 容器名字
➜ ~ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">-v</span> /home/mysql/conf:/etc/mysql/conf.d <span class="token parameter variable">-v</span> /home/mysql/data:/var/lib/mysql <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token parameter variable">--name</span> mysql01 mysql:5.7

<span class="token comment"># 启动成功之后，我们在本地使用sqlyog来测试一下</span>

<span class="token comment"># sqlyog-连接到服务器的3306--和容器内的3306映射  本机ip:3306</span>

<span class="token comment"># 在本地测试创建一个数据库，查看一下我们映射的路径是否ok！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/202107221051539.png" alt="在这里插入图片描述"></p>
<h2 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 匿名挂载</span>
<span class="token parameter variable">-v</span> 容器内路径！
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--name</span> nginx01 <span class="token parameter variable">-v</span> /etc/nginx nginx

<span class="token comment"># 查看所有的volume的情况</span>
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ lib<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     3df3ebf883092323908b31e21c761b56c937ee04ed51d418eedcc10df8d5f20a

<span class="token comment"># 这里发现，这种就是匿名挂载，我们在 -v 只写了容器内的路径，没有写容器外的路径！</span>

<span class="token comment"># 具名挂载</span>
➜ ~ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx02 <span class="token parameter variable">-v</span> juming-nginx:/etc/nginx nginx
➜ ~ <span class="token function">docker</span> volume <span class="token function">ls</span>
DRIVER         VOLUME NAME
<span class="token builtin class-name">local</span>         juming-nginx

<span class="token comment"># 通过 -v 卷名：容器内路径</span>

<span class="token comment"># 查看一下这个卷</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/20210722142200514.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>所有的docker容器内的卷，没有指定目录的情况下都是在 <code>/var/lib/docker/volumes/xxx/_data</code></p>
<p>我们通过具名挂载可以方便的找到我们的 一个卷，大多数情况使用的是 具名挂载</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 如何确定是具名挂载还是匿名挂载，还是指定路径挂载！</span>

<span class="token parameter variable">-v</span> 容器内路径          <span class="token comment"># 匿名挂载</span>

<span class="token parameter variable">-v</span> 卷名:容器内路径      <span class="token comment"># 具名挂载</span>

<span class="token parameter variable">-v</span> /宿主机路径:容器路径  <span class="token comment"># 指定路径挂载！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 通过 -v 容器内路径： ro rw 改变读写权限</span>
ro <span class="token builtin class-name">readonly</span>  <span class="token comment"># 只读</span>
rw readwrite <span class="token comment"># 可读可写</span>

<span class="token comment"># 一旦设置了容器权限，容器对我们挂载出来的内容就有限定了！</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx05 <span class="token parameter variable">-v</span> juming:/etc/nginx:ro nginx
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> nginx05 <span class="token parameter variable">-v</span> juming:/etc/nginx:rw nginx

<span class="token comment"># ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="在Dockerfile中挂载卷"><a href="#在Dockerfile中挂载卷" class="headerlink" title="在Dockerfile中挂载卷"></a>在Dockerfile中挂载卷</h2><blockquote>
<p>Dockerfile 就是用来构建docker镜像的构建文件！</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本就是一个一个的命令</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建一个dockerfile文件，名字可以随机 建议 Dockerfile</span>

<span class="token comment"># 文件中的内容 指令（大写）参数</span>
FROM centos
VOLUME <span class="token punctuation">[</span><span class="token string">"/volume01"</span>, <span class="token string">"/volume02"</span><span class="token punctuation">]</span>
CMD <span class="token builtin class-name">echo</span>  <span class="token string">"----end----------"</span>
CMD /bin/bash

<span class="token comment"># 这里的每个命令，就是镜像的一层！</span>
<span class="token function">docker</span> build <span class="token parameter variable">-f</span> 构建镜像的构建文件地址 <span class="token parameter variable">-t</span> 镜像名称 <span class="token builtin class-name">.</span>   <span class="token comment">#最后有一个 . 千万不要忘记</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/20210722152622819.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>启动自己写的镜像</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210722153212255.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>这个卷和外部一定有一个同步的目录！</p>
</blockquote>
<p><img src="/2022/12/15/docker/20210722155132469.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>查看一下卷挂载的路径</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">docker inspect 容器id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/20210722155018897.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>测试一下刚才的文件是否同步出去了！</p>
<p>这种方式使用的十分多，因为我们通常会构建自己的镜像！</p>
<p>假设构建镜像时候没有挂载卷，要手动镜像挂载 -v 卷名：容器内路径！</p>
</blockquote>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><blockquote>
<p>多个MySQL同步数据！</p>
<p>命名的容器挂载数据卷！</p>
</blockquote>
<p><img src="/2022/12/15/docker/509123ae482041b594dff90c81dd799c.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>启动3个容器，通过我们刚才自己写的镜像启动</p>
<p>docker01是使用Dockerfile的挂载卷，共享是的volume01、volume02两个文件夹</p>
</blockquote>
<p><img src="/2022/12/15/docker/dc3bb97cccc7034b8860dd00c9fcdf09.png" alt="在这里插入图片描述"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">--volumes-from list                Mount volumes from the specified container<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token comment"># 测试，</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/ade6838d7b0150f2678468edc41bf86c.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/12/15/docker/8f25073b40f7320ed453cadd9701ab43.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/12/15/docker/4d1a976f0ff841e5a046a37d999303a9.png" alt="在这里插入图片描述"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 串联</span>
<span class="token comment"># 测试，可以删除docker01，查看一下docker02 和 docker03 是否还可以访问这个文件</span>

<span class="token comment"># 测试，删除docker02，docker01hedocker02还可以共享数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>多个mysql实现数据共享</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜ ~ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">-v</span> /home/mysql/conf:/etc/mysql/conf.d <span class="token parameter variable">-v</span> /home/mysql/data:/var/lib/mysql <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token parameter variable">--name</span> mysql01 mysql:5.7

➜ ~ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3307</span>:3306 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token parameter variable">--name</span> mysql02 --volumes-from mysql01 mysql:5.7
<span class="token comment"># 这个时候，可以实现两个容器数据同步！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>结论：</p>
<p>容器之间的配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。</p>
<p>但是一旦你持久化到了本地，这个时候，本地的数据是不会删除的！</p>
</blockquote>
<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><h2 id="DockerFile介绍"><a href="#DockerFile介绍" class="headerlink" title="DockerFile介绍"></a>DockerFile介绍</h2><blockquote>
<p>dockerfile 是用来构建docker镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<p>1、 编写一个dockerfile文件</p>
<p>2、 docker build 构建称为一个镜像</p>
<p>3、 docker run运行镜像</p>
<p>4、 docker push发布镜像（DockerHub 、阿里云仓库)</p>
</blockquote>
<p><img src="/2022/12/15/docker/3e9dde477bcd4f10a93d106af5501e81.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/12/15/docker/765a0bd85ff947fcb008bfc88ecf9cab.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>但是很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像！</p>
<p>官方既然可以制作镜像，那我们也可以！</p>
</blockquote>
<h2 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h2><blockquote>
<p>基础知识：</p>
<p>1、每个保留关键字(指令）都是必须是大写字母</p>
<p>2、执行从上到下顺序</p>
<p>3、# 表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像层，并提交！</p>
</blockquote>
<p><img src="/2022/12/15/docker/c40a1beeb33140e687c92a3ef54a0680.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>Dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p>
<p>Docker镜像逐渐成企业交付的标准，必须要掌握！</p>
<p>DockerFile：构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages：通过DockerFile构建生成的镜像，最终发布和运行产品。</p>
<p>Docker容器：容器就是镜像运行起来提供服务。</p>
</blockquote>
<h2 id="DockerFile常用指令"><a href="#DockerFile常用指令" class="headerlink" title="DockerFile常用指令"></a>DockerFile常用指令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM             	<span class="token comment"># 基础镜像，一切从这里开始构建</span>
MAINTAINER        	<span class="token comment"># 镜像是谁写的， 姓名+邮箱</span>
RUN            		<span class="token comment"># 镜像构建的时候需要运行的命令</span>
ADD             	<span class="token comment"># 步骤，tomcat镜像，这个tomcat压缩包！添加内容 添加同目录</span>
WORKDIR         	<span class="token comment"># 镜像的工作目录</span>
VOLUME             	<span class="token comment"># 挂载的目录</span>
EXPOSE             	<span class="token comment"># 暴露端口配置</span>
CMD             	<span class="token comment"># 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span>
ENTRYPOINT         	<span class="token comment"># 指定这个容器启动的时候要运行的命令，可以追加命令</span>
ONBUILD         	<span class="token comment"># 当构建一个被继承 DockerFile 这个时候就会运行ONBUILD的指令，触发指令。</span>
COPY             	<span class="token comment"># 类似ADD，将我们文件拷贝到镜像中</span>
ENV             	<span class="token comment"># 构建的时候设置环境变量！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="CMD-和-ENTRYPOINT区别"><a href="#CMD-和-ENTRYPOINT区别" class="headerlink" title="CMD 和 ENTRYPOINT区别"></a>CMD 和 ENTRYPOINT区别</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CMD             	<span class="token comment"># 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span>
ENTRYPOINT         	<span class="token comment"># 指定这个容器启动的时候要运行的命令，可以追加命令</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="测试cmd"><a href="#测试cmd" class="headerlink" title="测试cmd"></a>测试cmd</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 编写dockerfile文件</span>
$ <span class="token function">vim</span> dockerfile-test-cmd
FROM centos
CMD <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>

<span class="token comment"># 构建镜像</span>
$ <span class="token function">docker</span> build <span class="token parameter variable">-f</span> dockerfile-test-cmd <span class="token parameter variable">-t</span> cmd-test:0.1 <span class="token builtin class-name">.</span>

<span class="token comment"># 运行镜像</span>
$ <span class="token function">docker</span> run cmd-test:0.1
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev

<span class="token comment"># 想追加一个命令 -l 成为ls -al</span>
$ <span class="token function">docker</span> run cmd-test:0.1 <span class="token parameter variable">-l</span>
docker: Error response from daemon: OCI runtime create failed:container_linux.go:349: starting container process caused <span class="token string">"exec: <span class="token entity" title="\&quot;">\"</span>-l<span class="token entity" title="\&quot;">\"</span>:executable file not found in <span class="token environment constant">$PATH</span>"</span><span class="token builtin class-name">:</span> unknown.
ERRO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> error waiting <span class="token keyword">for</span> container: context canceled

<span class="token comment"># cmd的情况下 -l 替换了CMD["ls","-l"]。 -l 不是命令所有报错</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="测试ENTRYPOINT"><a href="#测试ENTRYPOINT" class="headerlink" title="测试ENTRYPOINT"></a>测试ENTRYPOINT</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 编写dockerfile文件</span>
$ <span class="token function">vim</span> dockerfile-test-entrypoint

FROM centos
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>

$ <span class="token function">docker</span> run entrypoint-test:0.1
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found <span class="token punctuation">..</span>.

<span class="token comment"># 我们的命令，是直接拼接在我们得ENTRYPOINT命令后面的</span>
$ <span class="token function">docker</span> run entrypoint-test:0.1 <span class="token parameter variable">-l</span>
total <span class="token number">56</span>
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> May <span class="token number">16</span> 06:32 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> May <span class="token number">16</span> 06:32 <span class="token punctuation">..</span>
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">0</span> May <span class="token number">16</span> 06:32 .dockerenv
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">7</span> May <span class="token number">11</span> <span class="token number">2019</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">340</span> May <span class="token number">16</span> 06:32 dev
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> May <span class="token number">16</span> 06:32 etc
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> May <span class="token number">11</span> <span class="token number">2019</span> home
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">7</span> May <span class="token number">11</span> <span class="token number">2019</span> lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">9</span> May <span class="token number">11</span> <span class="token number">2019</span> lib64 -<span class="token operator">&gt;</span> usr/lib64 <span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h2><blockquote>
<p>Docker Hub中 99% 镜像都是从这个基础镜像过来的<code>FROM scratch</code> , 然后配置需要的软件和配置来进行的构建</p>
</blockquote>
<p><img src="/2022/12/15/docker/1e323c4feaf9415cbc0a79e7e2418c90.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1.编写Dockerfile文件</span>
<span class="token function">vim</span> mydockerfile-centos

FROM centos
MAINTAINER cheng<span class="token operator">&lt;</span><span class="token number">1204598429</span>@qq.com<span class="token operator">&gt;</span>
ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">vim</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> net-tools
EXPOSE <span class="token number">80</span>
CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">"-----end----"</span>
CMD /bin/bash

<span class="token comment"># 2、通过这个文件构建镜像</span>
<span class="token comment"># 命令 docker build -f 文件路径 -t 镜像名:[tag] .</span>
<span class="token function">docker</span> build <span class="token parameter variable">-f</span> mydockerfile-centos <span class="token parameter variable">-t</span> mycentos:0.1 <span class="token builtin class-name">.</span>
Successfully built f22b7b27d5d2
Successfully tagged mycentos:0.1

<span class="token comment"># 3、测试运行</span>
<span class="token function">docker</span> images
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> mycentos:0.1  <span class="token comment">#我们构建的时候写版本号了，使用镜像名运行不加版本号就是运行最新的，加版本号，是运行我们刚才制作的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>对比：之前的原生的centos</p>
</blockquote>
<p><img src="/2022/12/15/docker/77f72fde47d945708933e95b6bb2fb7a.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>我们增加之后的镜像</p>
</blockquote>
<p><img src="/2022/12/15/docker/886c3935a4e74b8198ba8750866fe32c.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>我们平时拿到一个镜像，可以研究一下它是怎么做的？</p>
</blockquote>
<p><img src="/2022/12/15/docker/0911c9df057342489a5ed0318a68d494.png" alt="在这里插入图片描述"></p>
<h2 id="实战：Tomcat镜像"><a href="#实战：Tomcat镜像" class="headerlink" title="实战：Tomcat镜像"></a>实战：Tomcat镜像</h2><blockquote>
<p>1、准备镜像文件</p>
<p>准备tomcat 和 jdk到当前目录，编写好README 。</p>
<p>2、编写dokerfile</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM centos:7
MAINTAINER sywl<span class="token operator">&lt;</span>xxxx@qq.com<span class="token operator">&gt;</span>
COPY readme.txt /usr/local/readme.txt
ADD jdk-8u271-linux-x64.tar.gz /usr/local/
ADD apache-tomcat-9.0.5.tar.gz /usr/local/
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">vim</span>
ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>
ENV JAVA_HOME /usr/local/jdk1.8.0_271
ENV CLASS_PATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar
ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.5
ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.5
ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib:<span class="token variable">$CATALINA_HOME</span>/bin
EXPOSE <span class="token number">8080</span>
CMD /usr/local/apache-tomcat-9.0.5/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> <span class="token parameter variable">-F</span> /usr/local/apache-tomcat-9.0.5/bin/logs/catalina.out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>3、构建镜像</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 因为dockerfile命名使用默认命名 因此不用使用-f 指定文件</span>

$ <span class="token function">docker</span> build <span class="token parameter variable">-t</span> mytomcat:0.1 <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>4、run镜像</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token parameter variable">--name</span> tomcat01 <span class="token parameter variable">-v</span> /home/kuangshen/build/tomcat/test:/usr/local/apache-tomcat-9.0.35/webapps/test <span class="token parameter variable">-v</span> /home/kuangshen/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.35/logs
mytomcat:0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>5、访问测试</p>
<p>6、发布项目(由于做了卷挂载，我们直接在本地编写项目就可以发布了！)</p>
<p>发现：项目部署成功，可以直接访问！</p>
<p>我们以后开发的步骤：需要掌握Dockerfile的编写！我们之后的一切都是使用docker镜像来发布运行！</p>
</blockquote>
<h1 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h1><h2 id="发布到Docker-Hub上"><a href="#发布到Docker-Hub上" class="headerlink" title="发布到Docker Hub上"></a>发布到Docker Hub上</h2><blockquote>
<p>1、地址 <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>2、确定这个账号可以登录</p>
<p>3、登录</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> login <span class="token parameter variable">--help</span>
Usage: <span class="token function">docker</span> login <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span>
Log <span class="token keyword">in</span> to a Docker registry.
If no server is specified, the default is defined by the daemon.
Options:
-p, <span class="token parameter variable">--password</span> string Password
--password-stdin Take the password from stdin
-u, <span class="token parameter variable">--username</span> string Username<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>4、提交 push镜像.</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># push自己的镜像到服务器上！</span>
$ <span class="token function">docker</span> push diytomcat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/33e5c9d809c049e59bf62d2e455535cd.png" alt="在这里插入图片描述"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 会发现push不上去，因为如果没有前缀的话默认是push到 官方的library</span>
<span class="token comment"># 解决方法</span>

<span class="token comment"># 第一种 build的时候添加你的dockerhub用户名，然后在push就可以放到自己的仓库了</span>
$ <span class="token function">docker</span> build <span class="token parameter variable">-t</span> 账号id/mytomcat:0.1 <span class="token builtin class-name">.</span>

<span class="token comment"># 第二种,增加一个tag</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ tomcat<span class="token punctuation">]</span><span class="token comment"># docker tag 6a5eb12e1252 账号id/tomcat:1.0</span>
<span class="token comment"># docker push即可；自己发布的镜像尽量带上版本号</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ tomcat<span class="token punctuation">]</span><span class="token comment"># docker push 账号id/tomcat:1.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/5e8f3ade8f7947f2a154c40c4b58d5ca.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>提交的时候也是按照镜像的层级来提交的！</p>
</blockquote>
<h2 id="阿里云镜像服务上"><a href="#阿里云镜像服务上" class="headerlink" title="阿里云镜像服务上"></a>阿里云镜像服务上</h2><blockquote>
<p>1、登录阿里云</p>
<p>2、找到容器镜像服务</p>
<p>3、创建命名空间</p>
<p>4、创建容器镜像</p>
<p>看官网 很详细<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/repository/">https://cr.console.aliyun.com/repository/</a></p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">docker</span> login <span class="token parameter variable">--username</span><span class="token operator">=</span>zchengx registry.cn-shenzhen.aliyuncs.com
$ <span class="token function">sudo</span> <span class="token function">docker</span> tag <span class="token punctuation">[</span>ImageId<span class="token punctuation">]</span> registry.cn-shenzhen.aliyuncs.com/dsadxzc/cheng:<span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span>
<span class="token comment"># 修改id 和 版本</span>
<span class="token function">sudo</span> <span class="token function">docker</span> tag a5ef1f32aaae registry.cn-shenzhen.aliyuncs.com/dsadxzc/cheng:1.0
<span class="token comment"># 修改版本</span>
$ <span class="token function">sudo</span> <span class="token function">docker</span> push registry.cn-shenzhen.aliyuncs.com/dsadxzc/cheng:<span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><p><img src="/2022/12/15/docker/ad5af27b75304b8ba2a4bf7a7163a9cd.png" alt="在这里插入图片描述"></p>
<h1 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h1><h2 id="理解Docker-0"><a href="#理解Docker-0" class="headerlink" title="理解Docker 0"></a>理解Docker 0</h2><p><img src="/2022/12/15/docker/94d1f7f7ffd74e13a8f055ce6dc9c6e4.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>问题： docker 是如果处理容器网络访问的？</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 测试 运行一个tomcat</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> tomcat01 tomcat

$ <span class="token function">ip</span> addr
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 00:16:3e:13:78:90 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.23</span>.104.112/20 brd <span class="token number">172.23</span>.111.255 scope global dynamic eth0
       valid_lft 314146894sec preferred_lft 314146894sec
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:c9:5a:27:6c brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
<span class="token number">441</span>: veth049f362@if440: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether ea:55:6c:48:c4:7e brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    
$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器id
$ <span class="token function">ip</span> addr
<span class="token comment"># 查看容器内部网络地址 发现容器启动的时候会得到一个 eth0@if551 ip地址，docker分配的！</span>
<span class="token number">550</span>: eth0@if551: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue
state UP group default
link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
valid_lft forever preferred_lft forever

<span class="token comment"># 思考？ linux能不能ping通容器内部！ 可以 容器内部可以ping通外界吗？ 可以！</span>
$ <span class="token function">ping</span> <span class="token number">172.17</span>.0.2
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.069</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.074</span> ms

<span class="token comment"># linux 可以ping 通docker容器内部</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><blockquote>
<p>1、我们每启动一个docker容器，Docker就会给docker容器分配一个ip，我们只要安装了docker，就会有一个docker0桥接模式，使用的技术是 veth-pair 技术！</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bakari/p/10613710.html">https://www.cnblogs.com/bakari/p/10613710.html</a></p>
<p>再次测试ip addr</p>
</blockquote>
<p><img src="/2022/12/15/docker/7c612b1f3ff949e587e96a48a6ab584f.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>2 、在启动一个容器测试，发现又多了一对网络</p>
</blockquote>
<p><img src="/2022/12/15/docker/f170b48be44743ae9877c723fc7248a2.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>我们发现这个容器带来网卡，都是一对对的</p>
<p><strong>veth-pair</strong> 就是一对的虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连，正因为有这个特性 veth-pair 充当一个桥梁，连接各种虚拟网络设备的OpenStac,Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</p>
<p>3、我们来测试下tomcat01和tomcat02是否可以ping通</p>
</blockquote>
<pre class="line-numbers language-SHELL" data-language="SHELL"><code class="language-SHELL">$ docker-tomcat docker exec -it tomcat01 ip addr #获取 tomcat01 的ip
172.17.0.2
550: eth0@if551: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue
state UP group default
link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
valid_lft forever preferred_lft forever
$ docker-tomcat docker exec -it tomcat02 ping 172.17.0.2 #让tomcat02 ping tomcat01
PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.098 ms
64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.071 ms

#  结论：容器和容器之间是可以互相ping通的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/cce22e1584b349f69aa07c6a01ad9d1e.png" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>结论</strong>：tomcat01和tomcat02公用一个路由器，docker0。</p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用ip。</p>
<p>小结： Docker使用的是Linux的桥接，宿主机是一个Docker容器的网桥 docker0</p>
</blockquote>
<p><img src="/2022/12/15/docker/690de016b877403296c0ec5edd23e370.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>Docker 中的所有的网络接口都是虚拟的。虚拟的转发效率高！</p>
<p>只要容器删除，对应网桥一对就没了！</p>
</blockquote>
<p><img src="/2022/12/15/docker/16e851ba1eb142059cb0461d5ecc2f30.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>思考一个场景：我们编写了一个微服务，database url=ip: ，项目不重启，数据库ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器？</p>
</blockquote>
<h2 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 通过服务名ping不通；如何解决？</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ping tomcat01</span>
ping: tomcat01: Name or <span class="token function">service</span> not known

<span class="token comment"># 通过--link可以解决网络连接问题。</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name tomcat03 --link tomcat02 tomcat:7.0</span>
2393eecb870e5755068ea8b7d8bdcdd0f1ff110534c3359384413677c651bec4
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat03 ping tomcat02</span>
PING tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.085</span> ms
<span class="token number">64</span> bytes from tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.055</span> ms

<span class="token comment"># 反向可以ping通吗？（不可以）</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ping tomcat03</span>
ping: tomcat03: Name or <span class="token function">service</span> not known<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>探究：</strong> docker network inspect 网络id 网段相同<br>docker inspect tomcat03</p>
</blockquote>
<p><img src="/2022/12/15/docker/kuangstudyb4c2cdd5-23f7-4cd0-bbdc-a6c843187c99.jpg" alt="img"></p>
<blockquote>
<p>其实这个tomcat03 就是本地配置了tomcat02的配置</p>
</blockquote>
<p><img src="/2022/12/15/docker/ac76669d0bae4229914b73e2ffdf98a9.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>–link 本质就是在hosts配置中添加映射</p>
<p>现在使用Docker已经不建议使用–link了！</p>
<p>自定义网络，不使用docker0！</p>
<p>docker0问题：不支持容器名连接访问！</p>
</blockquote>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> network <span class="token parameter variable">--help</span>
connect -- Connect a container to a network
create -- Creates a new network with a name specified by the
disconnect -- Disconnects a container from a network
inspect -- Displays detailed information on a network
<span class="token function">ls</span> -- Lists all the networks created by the user
prune -- Remove all unused networks
<span class="token function">rm</span> -- Deletes one or <span class="token function">more</span> networks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<p><img src="/2022/12/15/docker/04d730e68bd844809461e19c9482c9ad.png" alt="在这里插入图片描述"></p>
<h3 id="网络模式"><a href="#网络模式" class="headerlink" title="网络模式"></a>网络模式</h3><blockquote>
<p>bridge ：桥接 docker（默认，自己创建也是使用bridge模式）</p>
<p>none ：不配置网络，一般不用</p>
<p>host ：和所主机共享网络</p>
<p>container ：容器网络连通（用得少！局限很大）</p>
</blockquote>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 我们直接启动的命令默认添加--net bridge,而这个就是我们得docker0</span>
<span class="token comment"># bridge就是docker0</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat01 tomcat
等价于 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">--name</span> tomcat01 <span class="token parameter variable">--net</span> bridge tomcat
<span class="token comment"># docker0，特点：默认，域名不能访问。 --link可以打通连接，但是很麻烦！</span>

<span class="token comment"># 我们可以 自定义一个网络</span>
<span class="token comment"># --driver bridge			桥接模式</span>
<span class="token comment"># --subnet 192.168.0.0/16  	子网</span>
<span class="token comment"># --gateway 192.168.0.1    	网关</span>
$ <span class="token function">docker</span> network create <span class="token parameter variable">--driver</span> bridge <span class="token parameter variable">--subnet</span> <span class="token number">192.168</span>.0.0/16 <span class="token parameter variable">--gateway</span> <span class="token number">192.168</span>.0.1 mynet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/5101c9a64b8844948d2a1f74144db313.png" alt="在这里插入图片描述"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> network inspect mynet<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/f7695ce6d1e041e5ad49c5ae36ff3ef9.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>启动两个tomcat,再次查看网络情况</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name tomcat-net-01 --net mynet tomcat</span>
8f3b8236b5d9d149612d1dbe6b533c21601cfd7392cb5bf226a8427b5fc1b3e3
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name tomcat-net-02 --net mynet tomcat</span>
3279bc773cacaa51368f4417e42159732f046c0d300ce881fb0a598663e79779


<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect mynet</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"mynet"</span>,
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"be05f1f6f6909cee0d1e868acb718c47c3e2efb9f5f33ccc38b6955ae6fb3578"</span>,
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2021-07-26T11:11:10.09948571+08:00"</span>,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>,
        <span class="token string">"EnableIPv6"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"IPAM"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
            <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">"Subnet"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.0/16"</span>,
                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.1"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Internal"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"Attachable"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"Ingress"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"ConfigFrom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Network"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"ConfigOnly"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"3279bc773cacaa51368f4417e42159732f046c0d300ce881fb0a598663e79779"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat-net-02"</span>,
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"0d31467ee4bc86d1b55d1889a07b468b57aeb82a9b23bbb2e2df5632d158ac0f"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:03"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.3/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"8f3b8236b5d9d149612d1dbe6b533c21601cfd7392cb5bf226a8427b5fc1b3e3"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat-net-01"</span>,
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"7ae56746e954749dfd52c5f2965cc667d307b198f792175cca80040aed59eb52"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:02"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.2/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 再次测试 ping 连接</span>
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it  tomcat-net-01 ping 192.168.0.3</span>
PING <span class="token number">192.168</span>.0.3 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.135</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.099</span> ms

<span class="token comment"># 现在不使用--link也可以ping名字了</span>
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat-net-01 ping tomcat-net-02</span>
PING tomcat-net-02 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.095</span> ms
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.108</span> ms
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.093</span> ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在自定义的网络下，服务可以互相ping通，不用使用–link</p>
<p>我们自定义的网络docker当我们维护好了对应的关系，推荐我们平时这样使用网络！</p>
<p>好处：</p>
<ul>
<li>redis -不同的集群使用不同的网络，保证集群是安全和健康的</li>
<li>mysql-不同的集群使用不同的网络，保证集群是安全和健康的</li>
</ul>
</blockquote>
<p><img src="/2022/12/15/docker/6184a7c2d3b3460983a5463dafb0f05f.png" alt="在这里插入图片描述"></p>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># tomcat01在docker0网络下，tomcat-net-01在mynet网络下；</span>
<span class="token comment"># tomcat01 ping tomcat-net-01是ping不通的</span>
<span class="token punctuation">[</span>root@iZbp13qr3mm4ucsjumrlgqZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat01 ping tomcat-net-01</span>
ping: tomcat-net-01: Name or <span class="token function">service</span> not known<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>容器和mynet网络需要打通</p>
</blockquote>
<img src="/2022/12/15/docker/kuangstudy06b13128-bb64-478b-8f97-5aff19bc2536.jpg" alt="img" style="zoom:80%;">

<blockquote>
<p>打通命令</p>
</blockquote>
<img src="/2022/12/15/docker/kuangstudyec3a2bcc-43e6-4081-ae71-55e6c425c046.jpg" alt="img" style="zoom:120%;">

<p><img src="/2022/12/15/docker/44d046a5c4b74e6ebb4e890ba3067a7b.png" alt="在这里插入图片描述"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 测试：打通tomcat01连接mynet</span>
<span class="token function">docker</span> network connect mynet tomcat01
<span class="token comment"># 连通之后就是将tomcat01放到了mynet网络下</span>
<span class="token comment"># 一个容器两个ip地址！I</span>
<span class="token comment"># 阿里云服务：公网ip和私网ip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>要将tomcat01 连通 tomcat—net-01 ，连通就是将 tomcat01加到 mynet网络</p>
<p>一个容器两个ip（tomcat01）</p>
</blockquote>
<p><img src="/2022/12/15/docker/74df32fa98d74030bc7543cc36289c69.png" alt="vv"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 01 连通ok</span>
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat01 ping tomcat-net-01</span>
PING tomcat-net-01 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.130</span> ms
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.097</span> ms
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.106</span> ms
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.109</span> ms

<span class="token comment"># 02 是依旧打不通的</span>
<span class="token punctuation">[</span>root@iZ8vbgc3u6dvwrjyp45lyrZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ping tomcat-net-01</span>
ping: tomcat-net-01: Name or <span class="token function">service</span> not known<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>结论：假设要跨网络操作别人，就需要使用 docker network connect 连通！</p>
</blockquote>
<h2 id="实战：部署Redis集群"><a href="#实战：部署Redis集群" class="headerlink" title="实战：部署Redis集群"></a>实战：部署Redis集群</h2><p><img src="/2022/12/15/docker/5d90a471e0a34f2bafd51a05be204bf9.png" alt="在这里插入图片描述"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建网卡</span>
<span class="token function">docker</span> network create redis <span class="token parameter variable">--subnet</span> <span class="token number">172.38</span>.0.0/16

<span class="token comment"># 通过脚本创建六个redis配置</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf
<span class="token function">touch</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf</span>
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1<span class="token variable">${port}</span>
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF</span>
<span class="token keyword">done</span>

<span class="token comment"># 通过脚本运行六个redis</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token punctuation">\</span>
<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">637</span><span class="token variable">${port}</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">1667</span><span class="token variable">${port}</span>:16379 <span class="token parameter variable">--name</span> redis-<span class="token variable">${port}</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mydata/redis/node-<span class="token variable">${port}</span>/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.1<span class="token variable">${port}</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6371</span>:6379 <span class="token parameter variable">-p</span> <span class="token number">16671</span>:16379 <span class="token parameter variable">--name</span> redis-1 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mydata/redis/node-1/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token parameter variable">--net</span> redis <span class="token parameter variable">--ip</span> <span class="token number">172.38</span>.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis-1 /bin/sh <span class="token comment">#redis默认没有bash</span>

<span class="token comment"># 创建集群</span>
redis-cli <span class="token parameter variable">--cluster</span> create <span class="token number">172.38</span>.0.11:6379 <span class="token number">172.38</span>.0.12:6379 <span class="token number">172.38</span>.0.13:6379 <span class="token number">172.38</span>.0.14:6379 <span class="token number">172.38</span>.0.15:6379 <span class="token number">172.38</span>.0.16:6379 --cluster-replicas <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/a4779dc7085f417196743829214ed52a.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>docker搭建redis集群完成！</p>
<p>我们使用docker之后，所有的技术都会慢慢变得简单起来！</p>
</blockquote>
<h1 id="SpringBoot项目打包Docker镜像"><a href="#SpringBoot项目打包Docker镜像" class="headerlink" title="SpringBoot项目打包Docker镜像"></a>SpringBoot项目打包Docker镜像</h1><blockquote>
<p>1、构建SpringBoot项目</p>
</blockquote>
<blockquote>
<p>2、打包运行</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">mvn package<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>.3、编写dockerfile</p>
<pre class="line-numbers language-none"><code class="language-none">FROM java:8COPY *.jar /app.jarCMD ["--server.port=8080"]EXPOSE 8080ENTRYPOINT ["java","-jar","app.jar"]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>4、构建镜像</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none"># 1.复制jar和DockerFIle到服务器
# 2.构建镜像$ docker build -t xxxxx:xx .$ docker build -t kuangshen666 .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>5、发布运行</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@iZ8vbgc3u6dvwrjyp45lyrZ idea]# docker imagesREPOSITORY            TAG                IMAGE ID       CREATED         SIZEkuangshen666          latest             1ce036c6030a   4 minutes ago   660MBdocker run -d -P --name kuangshen-springboot-web kuangshen666<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/12/15/docker/b3dce69cb65f40b293dd4c917ae7b530.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>以后我们使用了Docker之后，给别人交付就是一个镜像即可！</p>
</blockquote>
<blockquote>
<p>数据库怎么弄？</p>
<p>docker拉取一个数据库，运行。打包jar之前需要修改数据库地址</p>
<p>ssm项目怎么弄？</p>
<p>在dockerfile中添加tomcat，然后在tomcat的下面添加我们打好的war</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM centos:7
 
RUN <span class="token function">mkdir</span> /usr/local/java
ADD jdk-8u231-linux-x64.tar.gz /usr/local/java
ENV <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/java/jdk1.8.0_231
ENV <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar:<span class="token variable">$JAVA_HOME</span>/jre/lib/rt.jar
ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin
 
RUN <span class="token function">mkdir</span> /usr/local/tomcat
ADD apache-tomcat-8.5.58.tar.gz /usr/local/tomcat
ENV <span class="token assign-left variable">CATALINA_HOME</span><span class="token operator">=</span>/usr/local/tomcat/apache-tomcat-8.5.58
ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$CATALINA_HOME</span>/bin
 
COPY fresh.war <span class="token variable">$CATALINA_HOME</span>/webapps/
 
EXPOSE <span class="token number">8080</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/usr/local/tomcat/apache-tomcat-8.5.58/bin/catalina.sh"</span>,<span class="token string">"run"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h1 id="Docker-compose容器编排"><a href="#Docker-compose容器编排" class="headerlink" title="Docker-compose容器编排"></a>Docker-compose容器编排</h1><blockquote>
<p>使用 <strong>Docker</strong> 的时候，定义 <strong>Dockerfile</strong> 文件，然后使用 <code>docker build</code>、<code>docker run</code> 等命令操作容器。</p>
<p>然而微服务架构的应用系统一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启停，这样效率很低，也不方便管理。</p>
<p>使用 <strong>Docker Compose</strong> 可以轻松、高效的管理容器，它是一个用于定义和运行多容器 Docker 的应用程序工具。</p>
</blockquote>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><blockquote>
<p>Docker Compose 是 Docker 的一个开源项目，目前托管到了 GitHub，需要前往 GitHub 下载。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">"https://github.com/docker/compose/releases/download/2.2.3/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p> 由于存放在 GitHub，国内网络限制导致不太稳定，<strong>不推荐使用</strong>。</p>
<p>推荐使用 <a target="_blank" rel="noopener" href="https://www.daocloud.io/">道客</a> 提供的 <a target="_blank" rel="noopener" href="http://get.daocloud.io/#install-compose">Docker 极速下载</a> 进行安装：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://get.daocloud.io/docker/compose/releases/download/v2.2.3/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>安装：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@sail ~<span class="token punctuation">]</span><span class="token comment"># curl -L https://get.daocloud.io/docker/compose/releases/download/v2.2.3/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed100   423  100   423    0     0    394      0  0:00:01  0:00:01 --:--:--   394100 23.5M  100 23.5M    0     0  8670k      0  0:00:02  0:00:02 --:--:-- 20.3M</span>
<span class="token punctuation">[</span>root@sail ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/bin/[root@sail bin]# lsdocker-compose</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>这样即表示安装成功。</p>
<p>授权：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@sail ~<span class="token punctuation">]</span><span class="token comment"># chmod +x /usr/local/bin/docker-compose</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h3><blockquote>
<p>docker-compose version</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@sail bin<span class="token punctuation">]</span><span class="token comment"># docker-compose versionDocker Compose version v2.2.3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>显示了版本即代表 Docker Compose 安装完成。</p>
</blockquote>
<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>由于 <strong>Linux 一切皆文件</strong>，删除此文件夹即可完成 Docker Compose 的卸载。</p>
</blockquote>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><blockquote>
<p>执行命令时，需要在对应的docker-compose.yml文件所在目录下执行。</p>
</blockquote>
<blockquote>
<p>1、查看帮助：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> <span class="token parameter variable">-h</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>2、创建并启动docker-compose服务：（类似 docker run）</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up<span class="token comment"># 后台运行docker-compose up -d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>3、停止并删除容器、网络、卷、镜像：（类似 docker stop + docker rm）</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> down<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>4、进入容器实例内部：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span>yml里面的服务id<span class="token operator">&gt;</span> /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>5、展示当前docker-compose编排过的运行的所有容器：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>6、展示当前docker-compose编排过的容器进程：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> <span class="token function">top</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>7、查看容器输出日志：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> log <span class="token operator">&lt;</span>yml里面的服务id<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>8、检查配置：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> config<span class="token comment"># 有问题才输出docker-compose config -q</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>9、重启服务：</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>10、启动服务：（类似 docker start）</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>11、停止服务：</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">docker-compose stop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#compose-file-structure-and-examples">官方示例</a></p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># docker-compose文件版本号</span>
version: <span class="token string">"3"</span>
<span class="token comment"># 配置各个容器服务</span>
services:
  microService:
    image: springboot_docker:1.0
    container_name: ms01  <span class="token comment"># 容器名称，如果不指定，会生成一个服务名加上前缀的容器名</span>
    ports:
      - <span class="token string">"6001:6001"</span>
    volumes:
      - /app/microService:/data
    networks:
      - springboot_network
    depends_on:  <span class="token comment"># 配置该容器服务所依赖的容器服务</span>
      - redis
      - mysql
  redis:
    image: redis:6.0.8
    ports:
      - <span class="token string">"6379:6379"</span>
    volumes:
      - /app/redis/redis.conf:/etc/redis/redis.conf
      - /app/redis/data:data
    networks:
      - springboot_network
    command: redis-server /etc/redis/redis.conf
  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: <span class="token string">'123456'</span>
      MYSQL_ALLOW_EMPTY_PASSWORD: <span class="token string">'no'</span>
      MYSQL_DATABASE: <span class="token string">'db_springboot'</span>
      MYSQL_USER: <span class="token string">'springboot'</span>
      MYSQL_PASSWORD: <span class="token string">'springboot'</span>
    ports:
      - <span class="token string">"3306:3306"</span>
    volumes:
      - /app/mysql/db:/var/lib/mysql
      - /app/mysql/conf/my.cnf:/etc/my.cnf
      - /app/mysql/init:/docker-entrypoint-initdb.d
    networks:
      - springboot_network
    command: --default-authentication-plugin<span class="token operator">=</span>mysql_native_password <span class="token comment"># 解决外部无法访问</span>
networks:
  <span class="token comment"># 创建 springboot_network 网桥网络</span>
  springboot_network:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在yaml目录下启动即可<code>docker-compose up</code></p>
</blockquote>
<h1 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h1><blockquote>
<p>Docker Swarm 和 Docker Compose 一样，都是 Docker 官方容器编排项目，但不同的是，Docker Compose 是一个在单个服务器或主机上创建多个容器的工具，而 Docker Swarm 则可以在多个服务器或主机上创建容器集群服务，对于微服务的部署，显然 Docker Swarm 会更加适合。</p>
</blockquote>
<p><img src="/2022/12/15/docker/image-20221219142721796.png" alt="image-20221219142721796"></p>
<h2 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h2><blockquote>
<p>查看docker swarm的命令</p>
<ul>
<li>init：初始化</li>
<li>join：加入到集群</li>
<li>leave：离开</li>
</ul>
</blockquote>
<p><img src="/2022/12/15/docker/image-20221219142751786.png" alt="image-20221219142751786"></p>
<blockquote>
<p>adverties-addr：广播地址，后面跟的是我们主机的地址</p>
</blockquote>
<p><img src="/2022/12/15/docker/image-20221219143141260.png" alt="image-20221219143141260"></p>
<blockquote>
<ul>
<li><p>docker swarm join 加入一个节点</p>
</li>
<li><pre><code>#获取令牌
docker swarm join-token manager
docker swarm join-token worker
#使用令牌可以加入一个leader节点或者worker节点
</code></pre>
</li>
</ul>
</blockquote>
<p><img src="/2022/12/15/docker/image-20221219143244370.png" alt="image-20221219143244370"></p>
<p><img src="/2022/12/15/docker/image-20221219143354601.png" alt="image-20221219143354601"></p>
<p><img src="/2022/12/15/docker/image-20221219143543234.png" alt="image-20221219143543234"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">L ZHEN</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://fahaxikilz.github.io/2022/12/15/docker/">http://fahaxikilz.github.io/2022/12/15/docker/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">L ZHEN</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Docker/">
                                    <span class="chip bg-color">Docker</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/valine/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'sxNXQ2L9Yj1y9VxBDX2sA6d8-gzGzoHsz',
        appKey: 'YgMUSzSrmuxo97dKBzjIl5dy',
        serverURLs: 'https://sxnxq2l9.lc-cn-n1-shared.com',
        notify: '' === 'true',
        verify: '' === 'true',
        visitor: 'true' === 'true',
        avatar: 'robohash',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'Just go go ^_^'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/01/03/leetcode-mysql/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/featureimages/8.jpg" class="responsive-img" alt="LeetCode_MySQL">
                        
                        <span class="card-title">LeetCode_MySQL</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-01-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/LeetCode/" class="post-category">
                                    LeetCode
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/LeetCode-MySQL/">
                        <span class="chip bg-color">LeetCode_MySQL</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/11/23/springcloud/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/medias/featureimages/10.jpg" class="responsive-img" alt="Spring Cloud">
                        
                        <span class="card-title">Spring Cloud</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-11-23
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="post-category">
                                    微服务
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Spring-Cloud/">
                        <span class="chip bg-color">Spring Cloud</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('8'),
            headingSelector: 'h1,h2,h3, h4,h5,h6,h7,h8'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2023</span>
            
            <a href="/about" target="_blank">L ZHEN</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">541.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/FahaxikiLz" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1390211724@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1390211724" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1390211724" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="197482151" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/FahaxikiLz/FahaxikiLz.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
